{{! ============================================
    CREACIN DE HECHOS
    Formulario para cargar nuevos hechos hist贸ricos
    ============================================ }}

{{! --- Header: Navegaci贸n del Usuario --- }}
{{#partial "contenido-header"}}
  {{#if esRegistrado}}
    <span> {{username}}</span>
    {{#if esAdmin}}
      <a href="/dashboard" class="link-primary">Panel Admin</a>
    {{/if}}
    <a href="/logout" class="link-danger">Cerrar sesi贸n</a>
  {{else}}
    <a href="/login" class="link-primary">Iniciar sesi贸n</a>
    <a href="/register" class="link-primary">Registrarse</a>
  {{/if}}
{{/partial}}

{{! ==========================================
    CONTENIDO PRINCIPAL
    ========================================== }}
{{#partial "contenido"}}
  <link rel="stylesheet" href="/assets/creacion.css">

  <div class="form-container">
    {{! --- T铆tulo de la P谩gina --- }}
    <h1>{{titulo}}</h1>

    {{! --- Mensajes Flash --- }}
    {{#if flash_error}}
      <div class="flash error">{{flash_error}}</div>
    {{/if}}

    {{#if flash_message}}
      <div class="flash success">{{flash_message}}</div>
    {{/if}}

    {{! ==========================================
        FORMULARIO DE CREACIN DE HECHO
        ========================================== }}
    <form action="/hechos" method="POST" enctype="multipart/form-data">

      {{! Campo: T铆tulo del Hecho }}
      <label for="titulo">T铆tulo</label>
      <input type="text" name="titulo" placeholder="Ej: Incendio en el centro" required>

      {{! Campo: Descripci贸n }}
      <label for="descripcion">Descripci贸n</label>
      <textarea name="descripcion" placeholder="Describe brevemente el hecho..." required></textarea>

      {{! Campo: Categor铆a }}
      <label for="categoria">Categor铆a</label>
      <input type="text" name="categoria" placeholder="Ej: Incendios, Accidentes, Contaminaci贸n" required>

      {{! Campo: Latitud }}
      <label for="latitud">Latitud</label>
      <input type="number" step="0.0001" name="latitud" placeholder="-34.6037" required>

      {{! Campo: Longitud }}
      <label for="longitud">Longitud</label>
      <input type="number" step="0.0001" name="longitud" placeholder="-58.3816" required>

      {{! Campo: Fecha del Acontecimiento }}
      <label for="fechaAcontecimiento">Fecha del Acontecimiento</label>
      <input type="datetime-local" name="fechaAcontecimiento" required>

      {{! Campo: Multimedia (opcional) }}
      <label for="multimedia">Contenido Multimedia (imagen o video)</label>
      <input type="file" name="multimedia" accept="image/*,video/*">

      {{! --- Vista Previa del Archivo --- }}
      <div class="preview" id="preview-container">
        <p><strong>Vista previa:</strong></p>
        <div id="preview-content"></div>
      </div>

      {{! Bot贸n de Env铆o }}
      <button type="submit"> Cargar Hecho</button>
    </form>
  </div>

  {{! ==========================================
      SCRIPT: Vista Previa de Multimedia
      ========================================== }}
  <script>
    const input = document.querySelector('input[name="multimedia"]');
    const previewContainer = document.getElementById('preview-container');
    const previewContent = document.getElementById('preview-content');

    input.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (!file) {
        previewContainer.style.display = 'none';
        return;
      }

      const url = URL.createObjectURL(file);
      previewContent.innerHTML = '';

      if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.src = url;
        previewContent.appendChild(img);
      } else if (file.type.startsWith('video/')) {
        const video = document.createElement('video');
        video.src = url;
        video.controls = true;
        previewContent.appendChild(video);
      }

      previewContainer.style.display = 'block';
    });
  </script>
{{/partial}}

{{> templates/layout}}

